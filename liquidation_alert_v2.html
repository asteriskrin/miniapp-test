<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquidation Alerts</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 8px;
            font-size: 16px;
            background-color: var(--tg-theme-secondary-bg-color, #f5f5f5);
            color: var(--tg-theme-text-color, #000000);
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, #3390ec);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .helper-text {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999);
            margin-top: 4px;
        }

        .token-preview {
            margin-top: 8px;
            padding: 8px;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 4px;
            font-size: 12px;
        }

        .token-count {
            font-weight: 600;
            color: var(--tg-theme-button-color, #3390ec);
        }

        h1 {
            margin-bottom: 24px;
            font-size: 24px;
        }

        .optional-badge {
            font-size: 11px;
            color: var(--tg-theme-hint-color, #999);
            font-weight: normal;
            margin-left: 4px;
        }
    </style>
</head>
<body>
    <h1>âš¡ Liquidation Alerts</h1>

    <form id="alertForm">
        <div class="form-group">
            <label for="address">
                Address
                <span class="optional-badge">(optional)</span>
            </label>
            <input 
                type="text" 
                id="address" 
                name="address" 
                placeholder="Enter wallet address"
            >
            <div class="helper-text">Leave empty to monitor all addresses</div>
        </div>

        <div class="form-group">
            <label for="tokens">Tokens *</label>
            <textarea 
                id="tokens" 
                name="tokens" 
                placeholder="ETH, BTC, SOL, AVAX"
                required
            ></textarea>
            <div class="helper-text">Enter token symbols separated by commas or new lines</div>
            <div class="token-preview" id="tokenPreview"></div>
        </div>

        <div class="form-group">
            <label for="usdc">Minimum Size (USDC) *</label>
            <input 
                type="number" 
                id="usdc" 
                name="usdc" 
                value="10000" 
                step="0.01"
                min="0"
                required
            >
            <div class="helper-text">Minimum liquidation size to alert on</div>
        </div>
    </form>

    <script>
        const tg = window.Telegram.WebApp;
        
        // Expand the web app
        tg.expand();
        
        // Get form elements
        const form = document.getElementById('alertForm');
        const addressInput = document.getElementById('address');
        const tokensInput = document.getElementById('tokens');
        const usdcInput = document.getElementById('usdc');
        const tokenPreview = document.getElementById('tokenPreview');

        // Parse tokens from textarea
        function parseTokens(text) {
            if (!text.trim()) return [];
            
            return text
                .split(/[,\n]+/)
                .map(token => token.trim().toUpperCase())
                .filter(token => token.length > 0);
        }

        // Update token preview
        function updateTokenPreview() {
            const tokens = parseTokens(tokensInput.value);
            if (tokens.length > 0) {
                tokenPreview.innerHTML = `<span class="token-count">${tokens.length} token${tokens.length > 1 ? 's' : ''}</span>: ${tokens.join(', ')}`;
            } else {
                tokenPreview.innerHTML = '<span style="color: var(--tg-theme-hint-color, #999);">No tokens entered</span>';
            }
        }

        // Validate form
        function validateForm() {
            const tokens = parseTokens(tokensInput.value);
            const usdc = parseFloat(usdcInput.value);
            
            if (tokens.length === 0) {
                tg.showAlert('Please enter at least one token');
                return false;
            }
            
            if (isNaN(usdc) || usdc < 0) {
                tg.showAlert('Please enter a valid USDC amount');
                return false;
            }
            
            return true;
        }

        // Listen for token input changes
        tokensInput.addEventListener('input', updateTokenPreview);
        
        // Initialize preview
        updateTokenPreview();

        // Configure MainButton
        tg.MainButton.setText('Submit Alert');
        tg.MainButton.show();
        tg.MainButton.enable();

        // Handle MainButton click
        tg.MainButton.onClick(() => {
            if (!validateForm()) {
                return;
            }

            const tokens = parseTokens(tokensInput.value);
            const address = addressInput.value.trim();
            const usdc = parseFloat(usdcInput.value);

            const formData = {
                address: address || null,
                tokens: tokens,
                minimum_sz: usdc
            };

            const jsonData = JSON.stringify({
                type: "liq",
                data: formData
            });
            
            console.log('Sending data:', jsonData);
            
            // Send data to bot
            tg.sendData(jsonData);
        });

        // Enable/disable submit button based on form validity
        form.addEventListener('input', () => {
            const tokens = parseTokens(tokensInput.value);
            const usdc = parseFloat(usdcInput.value);
            
            if (tokens.length > 0 && !isNaN(usdc) && usdc >= 0) {
                tg.MainButton.enable();
            } else {
                tg.MainButton.disable();
            }
        });

        // Theme colors
        document.body.style.backgroundColor = tg.themeParams.bg_color || '#ffffff';
        document.body.style.color = tg.themeParams.text_color || '#000000';
    </script>
</body>
</html>
